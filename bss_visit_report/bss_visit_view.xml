<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
	
		<!-- Visit -->
        <record id="edit_visit" model="ir.ui.view">
            <field name="name">bss_visit_report.visit</field>
            <field name="model">bss_visit_report.visit</field>
            <field name="arch" type="xml">
                <form string="Project" version="7.0">
                <header>
                	<button name="action_validate" string="Validate" type="object"
                            states="draft" groups="base.group_user" class="oe_highlight" />
                	<button name="action_terminate" string="Terminate" type="object"
                            states="pending" groups="base.group_user" class="oe_highlight" />
                	<button name="action_reopen" string="Re-open" type="object"
                            states="terminated" groups="base.group_user" />
                    <field name="state" widget="statusbar" statusbar_colors='{"draft":"blue"}' readonly="1" />
                </header>
                <sheet string="Visit">
                    <div>
                        <h1>
                        	<label string="Visit Report" class="oe_inline" />
                            <field name="ref" nolabel="True" class="oe_inline" />
                        </h1>
                        <h3>
                        	<field name="customer_id" nolabel="True" />
                        </h3>
                    </div>
                    <group>
	                    <group>
	                   		<field name="project_id" on_change="onchange_project_id(project_id)" />
	                   		<field name="user_id" />
	                   		<field name="date" />
	                   		<field name="linked_task_id" states="pending,terminated" />
	                   	</group>
	               		<group attrs="{'invisible': [('state', '=', 'draft')]}">
	               			<label for="hour_from" string="Attendance" />
	               			<span>
		               			<field name="hour_from" widget="float_time" class="oe_inline" />
		               			<label string="-" class="oe_inline" />
		               			<field name="hour_to" widget="float_time" class="oe_inline" />
	               			</span>
	                		<field name="time" widget="float_time" />    
	                     	<field name="travel_time" widget="float_time" />
	                     	<field name="travel_zone" />
	                    </group>
                    </group>
                    <group name="tasks" string="Tasks" attrs="{'invisible': [('state', '=', 'draft')]}">
                        <field name="visit_task_ids" nolabel="1">
                            <tree string="Tasks" version="7.0" editable="bottom">
                                <field name="task_id" domain="[('available_for_visit', '!=', False)]" />
                                <field name="priority" />
                                <field name="task_state" />
                                <field name="state" />
                                <field name="visit_state" invisible="1" />                                
                                <button type="object" name="do_cancel" string="Cancel" icon="gtk-cancel"
                                        attrs="{'invisible': ['|', ('state', '!=', 'todo'), ('visit_state', '=', 'terminated')]}" />
                                <button type="object" name="do_close" string="Terminate" icon="gtk-apply"
                                        attrs="{'invisible': ['|', ('state', '!=', 'todo'), ('visit_state', '=', 'terminated')]}" />
                                <button type="object" name="do_reopen" string="Re-open" icon="gtk-undo"
                                        attrs="{'invisible': ['|', ('state', '=', 'todo'), ('visit_state', '=', 'terminated')]}" />
                            </tree>
                        </field>
                    </group>
                    <group name="todo_tasks" string="Todo Tasks" attrs="{'invisible': [('state', '=', 'draft')]}">
                        <field name="todo_task_ids" nolabel="1">
                            <tree string="Todo Tasks" version="7.0">
                                <field name="name" />
                                <field name="priority" />
                                <field name="user_id" />
                                <field name="state" />
                                <field name="progress" widget="progressbar" invisible="context.get('set_visible',False)"/>
                            </tree>
                        </field>
                    </group>
                    <group name="closed_tasks" string="Closed Tasks" attrs="{'invisible': [('state', '=', 'draft')]}">
                        <field name="closed_task_ids" nolabel="1">
                            <tree string="Closed Tasks" version="7.0">
                                <field name="name" />
                                <field name="priority" />
                                <field name="user_id" />
                                <field name="state" />
                                <field name="progress" widget="progressbar" invisible="context.get('set_visible',False)"/>
                            </tree>
                        </field>
                    </group>
                </sheet>
                </form>
            </field>
        </record>

        <record id="list_visit" model="ir.ui.view">
            <field name="name">bss_visit_report.visit</field>
            <field name="model">bss_visit_report.visit</field>
            <field name="arch" type="xml">
				<tree string="Project" version="7.0">
					<field name="ref" />
					<field name="customer_id" />
					<field name="project_id" />
					<field name="user_id" />
					<field name="date" />
					<field name="state" />
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_visit_management">
            <field name="name">Visits</field>
            <field name="res_model">bss_visit_report.visit</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>

        <menuitem
            name="Visits" 
            id="menu_visit_management" 
            action="action_visit_management" 
            parent="bss_visit_report.menu_visit_report" sequence="1" />

	</data>
</openerp>