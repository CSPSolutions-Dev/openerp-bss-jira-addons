-
  In order to test the Attendance Sheet module in OpenERP,
-
  I set attendance settings for main company.
-
  !record {model: bss_attendance_sheet.breaks_settings, id: attendance_settings_default}:
    company_id: base.main_company
    name: '2013-01-01'
    break_offered: 0.25
    minimum_break: 0.17
    midday_break_from: 6.0
    minimum_midday: 0.5
-
  I update Valérie Descamps to add attendance sheet values.
-
  !record {model: hr.employee, id: hr.employee_vad}:
    tz: 'UTC'
    attendance_start: 10.0
-
  I create am attendance sheet for Valérie Descamps.
-
  !record {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    name: '2013-01-01'
    employee_id: hr.employee_vad
-
  I initialize the created sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet at start.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 0.0
    - total_break == 0.0
    - total_midday == 0.0
    - total_recorded == 0.0
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 0.0
    - cumulative_difference == 10.0
-
  I add a standard sign in for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_01}:
    employee_id: hr.employee_vad
    name: '2013-01-01 08:12:47'
    type: 'std'
    action: 'sign_in'
-
  I check the stored time is round at minute.
-
  !assert {model: hr.attendance, id: attendance_fp_01}:
    - name == '2013-01-01 08:12:00'
-
  I update the sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet after update.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 15.8
    - total_break == 0.0
    - total_midday == 0.5
    - total_recorded == 15.3
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 15.3
    - cumulative_difference == 25.3
-
  I add a pause sign out for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_02}:
    employee_id: hr.employee_vad
    name: '2013-01-01 10:00:00'
    type: 'break'
    action: 'sign_out'
-
  I add a pause sign in for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_03}:
    employee_id: hr.employee_vad
    name: '2013-01-01 10:06:00'
    type: 'break'
    action: 'sign_in'
-
  I update the sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet after update.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 15.7
    - total_break == 0.0
    - total_midday == 0.5
    - total_recorded == 15.3
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 15.3
    - cumulative_difference == 25.3
-
  I add a midday pause sign out for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_04}:
    employee_id: hr.employee_vad
    name: '2013-01-01 12:00:00'
    type: 'midday'
    action: 'sign_out'
-
  I add a midday pause sign in for Valérie Descamps after 15 minutes.
-
  !record {model: hr.attendance, id: attendance_fp_05}:
    employee_id: hr.employee_vad
    name: '2013-01-01 12:15:00'
    type: 'midday'
    action: 'sign_in'
-
  I update the sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet after update.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 15.45
    - total_break == 0.0
    - total_midday == 0.5
    - total_recorded == 15.3
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 15.3
    - cumulative_difference == 25.3
-
  I update the midday pasue sign in for Valérie Descamps to have a 1 hour midday break.
-
  !record {model: hr.attendance, id: attendance_fp_05}:
    employee_id: hr.employee_vad
    name: '2013-01-01 13:00:00'
    type: 'midday'
    action: 'sign_in'
-
  I update the sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet after update.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 14.7
    - total_break == 0.0
    - total_midday == 1.0
    - total_recorded == 14.8
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 14.8
    - cumulative_difference == 24.8
-
  I add a pause sign out for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_06}:
    employee_id: hr.employee_vad
    name: '2013-01-01 15:00:00'
    type: 'break'
    action: 'sign_out'
-
  I add a pause sign in for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_07}:
    employee_id: hr.employee_vad
    name: '2013-01-01 15:20:00'
    type: 'break'
    action: 'sign_in'
-
  I update the sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet after update.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 14.37
    - total_break == 0.25
    - total_midday == 1.0
    - total_recorded == 14.55
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 14.55
    - cumulative_difference == 24.55
-
  I add a sign out for Valérie Descamps.
-
  !record {model: hr.attendance, id: attendance_fp_08}:
    employee_id: hr.employee_vad
    name: '2013-01-01 18:00:00'
    type: 'std'
    action: 'sign_out'
-
  I update the sheet
-
  !python {model: bss_attendance_sheet.sheet}: |
    self._check_sheet(cr, uid, ref('hr.employee_vad'), '2013-01-01')
-
  I check the sheet after update.
-
  !assert {model: bss_attendance_sheet.sheet, id: attendance_sheet_fp_2013_01_01}:
    - name == '2013-01-01'
    - month == '2013-01'
    - total_attendance == 8.37
    - total_break == 0.25
    - total_midday == 1.0
    - total_recorded == 8.55
    - holidays_time == 0.0
    - expected_time == 0.0
    - time_difference == 8.55
    - cumulative_difference == 18.55
    
    